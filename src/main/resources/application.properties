quarkus.banner.enabled=false

# =============================================================================
# OBSERVABILITY CONFIGURATION
# =============================================================================

# Metrics Configuration
quarkus.micrometer.enabled=true
quarkus.micrometer.export.prometheus.enabled=${quarkus.micrometer.enabled}
quarkus.micrometer.export.prometheus.path=/q/metrics

# Health Checks
quarkus.smallrye-health.enabled=${quarkus.micrometer.enabled}
quarkus.smallrye-health.root-path=/q/health

# Enhanced Logging
quarkus.log.level=${LOG_LEVEL:INFO}
quarkus.log.category."io.agroal".min-level=TRACE
quarkus.log.category."io.agroal".level=DEBUG
quarkus.log.category."io.quarkus.http.access-log".level=INFO

# Database Telemetry
quarkus.datasource.jdbc.telemetry=true

# HTTP Access Logging
quarkus.http.access-log.enabled=true
quarkus.http.access-log.pattern=%h %l %u %t "%r" %s %b "%{i,Referer}" "%{i,User-Agent}" %D

# Application Name for Metrics
quarkus.application.name=elicit-fhhs

# Database Metrics
quarkus.datasource.metrics.enabled=${quarkus.micrometer.enabled}

# FHHS-specific metrics
fhhs.metrics.report.generation.enabled=${quarkus.micrometer.enabled}

# Datasource
quarkus.datasource.db-kind=postgresql
quarkus.datasource.db-version=17
quarkus.datasource.jdbc.url=jdbc:postgresql://db:5432/survey?connectTimeout=30&socketTimeout=600&tcpKeepAlive=true&tcpKeepAlivesIdle=60&tcpKeepAlivesInterval=10&tcpKeepAlivesCount=60
quarkus.datasource.jdbc.min-size=5
quarkus.datasource.jdbc.validation-query-sql=SELECT 1
quarkus.datasource.jdbc.leak-detection-interval=10m
quarkus.datasource.jdbc.metrics.enabled=${quarkus.micrometer.enabled}
quarkus.datasource.username=survey_user
quarkus.datasource.password=SURVEYPW

# Datasource owner
quarkus.datasource.owner.db-kind=postgresql
quarkus.datasource.owner.db-version=17
quarkus.datasource.owner.jdbc.url=jdbc:postgresql://db:5432/survey?connectTimeout=30&socketTimeout=600&tcpKeepAlive=true&tcpKeepAlivesIdle=60&tcpKeepAlivesInterval=10&tcpKeepAlivesCount=60
quarkus.datasource.owner.jdbc.validation-query-sql=SELECT 1
quarkus.datasource.owner.jdbc.leak-detection-interval=10m
quarkus.datasource.owner.username=elicit_owner
quarkus.datasource.owner.password=SURVEYPW
quarkus.datasource.owner.jdbc.transaction-isolation-level=serializable

# Flyway minimal config properties
# if migrate-at-start is false the MigrationService.Repair() will run!
quarkus.flyway.owner.migrate-at-start=true
quarkus.flyway.owner.baseline-on-migrate=true
quarkus.flyway.owner.schemas=survey
quarkus.flyway.owner.validate-on-migrate=true
quarkus.flyway.owner.baseline-version=0
quarkus.flyway.owner.baseline-description=Empty Database
quarkus.flyway.owner.connect-retries=10
quarkus.flyway.owner.table=flyway_fhhs_history
quarkus.flyway.owner.placeholders.survey_user=survey_user
quarkus.flyway.owner.placeholders.surveyadmin_user=surveyadmin_user
quarkus.flyway.owner.placeholders.surveyreport_user=surveyreport_user
quarkus.flyway.owner.locations=db/migration

# Default Image
quarkus.container-image.tag=latest
quarkus.container-image.registry=docker.io
quarkus.container-image.group=elicitsoftware
quarkus.container-image.name=fhhs
quarkus.container-image.build=true

#Dev properties
%dev.quarkus.http.port=8082
%dev.pedigree.url=http://localhost:8083/svg
%dev.quarkus.hibernate-orm.log.sql=false
%dev.quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5452/survey
%dev.quarkus.datasource.owner.jdbc.url=jdbc:postgresql://localhost:5452/survey
%dev.quarkus.datasource.dev.jdbc.url=jdbc:postgresql://localhost:5452/survey
%dev.quarkus.datasource.dev.db-kind=postgresql
%dev.quarkus.datasource.dev.db-version=16
%dev.quarkus.datasource.dev.username=elicit_owner
%dev.quarkus.datasource.dev.password=SURVEYPW
%dev.quarkus.datasource.dev.jdbc.transaction-isolation-level=serializable
%dev.quarkus.flyway.owner.locations=db/migration,db/dev

# SFTP Configuration
# The service supports both password and SSH key authentication.
# If both are configured, SSH key authentication takes precedence.
# Configure either password OR privateKey, not both.

# Docker SFTP Configuration (using password authentication)
%docker.family.history.sftp.host=sftpServer
%docker.family.history.sftp.username=fhhs_user
%docker.family.history.sftp.password=pass
%docker.family.history.sftp.path=/upload/reports
%docker.family.history.sftp.port=22

# Production SFTP Configuration (using SSH key authentication)
# Uncomment and configure for production use
#family.history.sftp.host=your-sftp-server.com
#family.history.sftp.username=fhhs_user
#family.history.sftp.privateKey=/path/to/your/private/key
#family.history.sftp.path=/upload/reports
#family.history.sftp.port=22

# Dev SFTP Configuration (using SSH key authentication)
%dev.family.history.sftp.host=localhost
%dev.family.history.sftp.username=fhhs_user
%dev.family.history.sftp.path=/upload/reports
%dev.family.history.sftp.port=22
# Choose authentication method:
# Option 1: Password authentication (uncomment for password auth)
#%dev.family.history.sftp.password=pass
# Option 2: SSH Key authentication (comment out for password auth)
%dev.family.history.sftp.privateKey=../sftp_ssh/fhhs_user

# Family History Async Configuration
family.history.async.threads=2
%dev.family.history.async.threads=1

# Console logging format for development (human-readable)
%dev.quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n
%dev.quarkus.log.console.json=false
# Override any potential JSON logging from parent configs
quarkus.log.console.json=false

# Debug logging for SFTP authentication troubleshooting
%dev.quarkus.log.category."com.elicitsoftware.familyhistory.SftpService".level=DEBUG
%dev.quarkus.log.category."com.jcraft.jsch".level=DEBUG

# Application Base URL for PDF generation
app.base.url=${APP_BASE_URL:http://localhost:8080}
quarkus.native.additional-build-args=--initialize-at-run-time=org.apache.batik